# Фронтенд-сервис "ГеоИнфоСистема"

Этот сервис представляет собой клиентское одностраничное приложение (SPA), разработанное для взаимодействия с бэкенд-сервисами "ГеоИнфоСистемы".

## Технологический стек

- **Фреймворк:** [Vue.js](https://vuejs.org/) (v3)
- **Сборщик:** [Vite](https://vitejs.dev/)
- **Язык:** [TypeScript](https://www.typescriptlang.org/)
- **UI-библиотека:** [Vuetify](https://vuetifyjs.com/) (v3, Material Design)
- **Управление состоянием:** [Vuex](https://vuex.vuejs.org/) (v4)
- **Маршрутизация:** [Vue Router](https://router.vuejs.org/) (v4)
- **Картографическая библиотека:** [OpenLayers](https://openlayers.org/)
- **HTTP-клиент:** [Axios](https://axios-http.com/)
- **Стилизация:** [Sass](https://sass-lang.com/) (SCSS)

## Структура проекта

Основные директории в `src/`:

- `assets/`: Статические ресурсы (изображения, шрифты).
- `components/`: Переиспользуемые компоненты Vue.
- `layouts/`: Компоненты-макеты страниц (например, `FullLayout` для основного интерфейса и `BlankLayout` для страниц авторизации).
- `plugins/`: Конфигурация плагинов (например, `vuetify.ts`).
- `router/`: Конфигурация маршрутизации.
- `scss/`: Глобальные стили SCSS.
- `services/`: Сервисы для взаимодействия с API (Axios, обработка токенов).
- `store/`: Модули управления состоянием Vuex.
- `types/`: Определения типов TypeScript для API и других сущностей.
- `views/`: Компоненты-страницы, соответствующие маршрутам.

## Переменные окружения

### Для локальной разработки

Во время локальной разработки (`npm run dev`) используется прокси-сервер Vite для перенаправления API-запросов. Конфигурация находится в `vite.config.ts`:

```typescript
// vite.config.ts
server: {
  port: 8080,
  proxy: {
    '/api': {
      target: 'http://localhost:9005', // Адрес API Gateway
      changeOrigin: true
    }
  }
}
```

Это позволяет избежать проблем с CORS, направляя все запросы с `/api` на API Gateway.

### Для Production (Docker)

В производственной среде (Docker) используется другой механизм. Приложение собирается с плейсхолдерами (например, `__VITE_API_GATEWAY_URL__`). При запуске контейнера скрипт `entrypoint.sh` заменяет эти плейсхолдеры на реальные значения из переменных окружения, переданных в контейнер.

Плейсхолдеры и их назначение:
- `__VITE_API_URL__`: Базовый путь для API (обычно `/`).
- `__VITE_API_GATEWAY_URL__`: Полный публичный URL шлюза API, который используется для некоторых прямых запросов.
- `__VITE_AUTH_SERVICE_URL__`: Прямой URL сервиса аутентификации. Используется в процессе OAuth 2.0.
- `__VITE_AUTH_CALLBACK_URL__`: URL, на который сервер аутентификации перенаправляет пользователя после успешного входа.
- `__VITE_ONLYOFFICE_URL__`: Публичный URL сервера документов OnlyOffice.
- `__VITE_GEOSERVER_URL__`: Публичный URL WMS-эндпоинта GeoServer.
- `__VITE_ONLYOFFICE_API_URL__`: URL API сервиса документов, используемый для колбэков от OnlyOffice.

Эти переменные задаются в файле `docker-compose.prod.yml`.

## Установка и запуск

### 1. Локальная разработка

Для запуска фронтенда в режиме разработки, когда все бэкенд-сервисы запущены локально (например, через `docker-compose.dev.yml`):

```shell
# Установка зависимостей
npm install

# Запуск сервера для разработки с hot-reload
npm run dev
```

Приложение будет доступно по адресу `http://localhost:8080`.

### 2. Сборка для Production

Для сборки приложения в статические файлы, готовые к развертыванию:

```shell
# Сборка проекта
npm run build
```

Результат сборки будет помещен в директорию `dist/`.

### 3. Развертывание через Docker

Сервис полностью готов к развертыванию через Docker. `Dockerfile` использует многоэтапную сборку:
1. На первом этапе (`build-stage`) происходит сборка статических файлов с помощью Node.js.
2. На втором этапе (`deploy-stage`) используется легковесный образ Nginx, куда копируются только собранные файлы.

Nginx настроен для:
- **Обслуживания SPA:** Все запросы перенаправляются на `index.html` для корректной работы Vue Router.
- **Проксирования API:** Запросы к `/api/` перенаправляются на `api-gateway`.

При запуске контейнера скрипт `entrypoint.sh` автоматически подставляет нужные URL для API из переменных окружения.

## Доступные скрипты

- `npm run dev`: Запуск сервера для разработки.
- `npm run build`: Сборка проекта для production.
- `npm run preview`: Локальный просмотр production-сборки.
- `npm run lint`: Проверка кода с помощью ESLint.
- `npm run typecheck`: Проверка типов TypeScript.