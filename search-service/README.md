# Search Service

## 1. Обзор

`search-service` — это микросервис, отвечающий за предоставление централизованного полнотекстового поиска по всем данным в "ГеоИнфоСистеме". Он индексирует данные из других сервисов и предоставляет быстрый и гибкий API для выполнения поисковых запросов.

## 2. Архитектура и бизнес-процесс

Сервис спроектирован по принципу CQRS (Command Query Responsibility Segregation), где он отвечает исключительно за чтение (поиск) данных. Он не имеет собственной реляционной базы данных и полностью зависит от асинхронных событий.

1.  **Получение данных:** Сервис подписывается на топики Apache Kafka:
    - `geo.data.events`: События о создании, обновлении и удалении геообъектов.
    - `doc.data.events`: События о создании, обновлении и удалении документов.
2.  **Индексация:** При получении события, `KafkaMessageConsumer` передает его в `IndexingService`, который преобразует и сохраняет (или удаляет) данные в соответствующих индексах Elasticsearch.
3.  **Поиск:** `SearchController` предоставляет HTTP-эндпоинты, которые транслируют запросы в нативные поисковые запросы Elasticsearch.

Такая архитектура обеспечивает слабую связанность между сервисами и позволяет `search-service` масштабироваться независимо.

## 3. Технологический стек

- **Фреймворк:** Spring Boot 3
- **Язык:** Java 17
- **Поисковый движок:** Elasticsearch
- **Брокер сообщений:** Apache Kafka
- **Сборка:** Apache Maven

## 4. Индексы Elasticsearch

Сервис управляет двумя основными индексами:

### `geo_index`
Хранит денормализованные данные о геообъектах для быстрого поиска.
- **Ключевые поля:** `id`, `name`, `description`, `type`, `geometry` (тип `geo_shape`), `document_count`.

### `document_index`
Хранит метаданные и, опционально, извлеченное содержимое документов.
- **Ключевые поля:** `id`, `geo_object_id`, `file_name`, `description`, `tags`, `content`.

## 5. API Endpoints

Сервис предоставляет REST API по базовому пути `/api/search`.

### `GET /all`
- **Описание:** Выполняет глобальный поиск по всем индексам (`geo_index`, `document_index`).
- **Параметры:**
    - `query` (string): Текст для поиска.
    - `pageable`: Настройки пагинации.
- **Поля для поиска:** `name`, `description`, `file_name`, `content`, `tags`.

### `GET /geo`
- **Описание:** Выполняет поиск только по геообъектам с возможностью фильтрации.
- **Параметры:**
    - `query` (string): Текст для поиска.
    - `types` (List<String>): Список типов объектов для фильтрации (например, `POINT`, `POLYGON`).
    - `pageable`: Настройки пагинации.
- **Поля для поиска:** `name`, `description`.

## 6. Сборка и запуск

Для сборки и запуска сервиса локально используйте Maven:

```bash
# Сборка проекта
mvn clean install

# Запуск сервиса
mvn spring-boot:run
```
