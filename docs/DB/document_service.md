## **Финальная Схема Базы Данных PostgreSQL для Document Service**

Данная схема предназначена для хранения метаданных файлов, которые физически располагаются в MinIO, и обеспечения связи с геообъектами.

### **1\. Таблица documents (Метаданные Документов)**

Основная таблица для всех записей о документах.

| Колонка | Тип данных | Описание | Ограничения/Индексы |
| :---- | :---- | :---- | :---- |
| id | UUID | Первичный ключ. Используется в API и для связи с Geo Data Service. | PRIMARY KEY |
| geo\_object\_id | UUID | ID геообъекта, к которому привязан документ (из Geo Data Service). | NOT NULL, INDEX |
| file\_name | VARCHAR(255) | Оригинальное имя файла, загруженного пользователем. | NOT NULL |
| minio\_object\_key | VARCHAR(255) | **Ключ объекта в MinIO.** Используется для скачивания/удаления бинарного файла. | NOT NULL, UNIQUE |
| mime\_type | VARCHAR(100) | Тип файла (например, application/pdf, image/jpeg). | NOT NULL |
| file\_size\_bytes | BIGINT | Размер файла в байтах. | NOT NULL |
| description | TEXT | Краткое описание или протокол осмотра. |  |
| uploaded\_by\_user\_id | UUID | ID пользователя, загрузившего файл. |  |
| upload\_date | TIMESTAMP WITH TIME ZONE | Дата и время загрузки. | NOT NULL |
| is\_latest\_version | BOOLEAN | Флаг для версионирования (например, после сохранения из OnlyOffice). | DEFAULT TRUE |

### **2\. Таблица tags (Справочник Тегов)**

Список уникальных тегов, используемых в системе.

| Колонка | Тип данных | Описание | Ограничения/Индексы |
| :---- | :---- | :---- | :---- |
| id | BIGINT | Первичный ключ. | PRIMARY KEY, SERIAL |
| name | VARCHAR(50) | Название тега (например, "Протокол", "2024", "Смета"). | NOT NULL, UNIQUE |

### **3\. Таблица document\_tag\_link (Связь Тегов и Документов)**

Таблица "многие-ко-многим" для связи документов и тегов.

| Колонка | Тип данных | Описание | Ограничения/Индексы |
| :---- | :---- | :---- | :---- |
| document\_id | UUID | ID документа. | FOREIGN KEY, PRIMARY KEY (составной) |
| tag\_id | BIGINT | ID тега. | FOREIGN KEY, PRIMARY KEY (составной) |

