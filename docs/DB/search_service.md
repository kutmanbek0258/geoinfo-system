## **Финальная Схема Индексов Elasticsearch (Search Service)**

Сервис **Search Service** использует **Elasticsearch** для асинхронной индексации и быстрого поиска. Схема (маппинг) определяет, как данные из PostGIS и PostgreSQL должны храниться и индексироваться.

### **1\. Индекс geo\_index (Геообъекты)**

Индекс для данных, поступающих из **Geo Data Service** (geo\_objects). Он оптимизирован для полнотекстового поиска и геопространственных запросов.

| Поле (Source: geo\_objects) | Тип Elasticsearch | Описание и Роль |
| :---- | :---- | :---- |
| id | keyword | Уникальный ID объекта (UUID). Используется для точного совпадения. |
| name | text | Название объекта. Используется для полнотекстового поиска. |
| description | text | Описание объекта. Используется для полнотекстового поиска. |
| type | keyword | Тип объекта ("Трансформатор", "Граница\_Участка"). Используется для точной фильтрации (фасетный поиск). |
| **geometry** | **geo\_shape** | Геометрия объекта. Критически важно для пространственных запросов (intersects, within). |
| characteristics | object | Индексирование полей JSONB для поиска по неструктурированным метаданным. |
| document\_count | integer | Счетчик привязанных документов. Используется для фильтрации/сортировки. |
| created\_at | date | Дата создания. Используется для сортировки и фильтрации по дате. |

### **2\. Индекс document\_index (Документы)**

Индекс для метаданных и содержимого документов, поступающих из **Document Service**.

| Поле (Source: documents & document\_tag\_link) | Тип Elasticsearch | Описание и Роль |
| :---- | :---- | :---- |
| id | keyword | Уникальный ID документа (UUID). |
| geo\_object\_id | keyword | ID геообъекта, к которому привязан документ. Используется для связывания результатов поиска с картой. |
| file\_name | text | Имя файла. Используется для полнотекстового поиска. |
| description | text | Краткое описание документа. Используется для полнотекстового поиска. |
| **tags** | **keyword** | Агрегированный список тегов. Используется для точной фильтрации (фасетный поиск). |
| mime\_type | keyword | Тип файла. Используется для фильтрации. |
| uploaded\_by\_user\_id | keyword | ID пользователя, загрузившего файл. |
| upload\_date | date | Дата загрузки. Используется для сортировки и фильтрации. |
| **content** | **text** | *Опциональное поле:* Содержимое документа, извлеченное из MinIO (например, с помощью Apache Tika) и проиндексированное. |

Эта структура индексов обеспечивает выполнение всех требований к поиску: поиск по названию/описанию (text), фильтрация по типу/тегу (keyword) и выполнение сложных геозапросов (geo\_shape).

Мы завершили описание всех схем данных и архитектуры. Теперь мы можем перейти к **техническому дизайну Front-end**.

**Согласны ли вы перейти к детализации Front-end (Vue.js и OpenLayers)?**