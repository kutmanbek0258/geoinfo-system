Техническое Задание на Разработку Системы Интерактивной Карты для Организации
1. Общие положения
   1.1. Назначение документа
   Настоящее Техническое Задание (ТЗ) определяет цели, задачи, требования, функциональность, архитектуру и этапы разработки системы интерактивной карты для организации. Документ служит основой для проектирования, разработки, тестирования и внедрения системы.

1.2. Цели и задачи
Цель: Создание современной, масштабируемой и безопасной веб-системы интерактивной карты для визуализации, управления и анализа геопространственных данных (маркеров, линий, полигонов) организации, включая отображение картографических данных (изображений с геометаданными) с дронов, с возможностью привязки документов и ролевым доступом.

Задачи:

Разработка интуитивно понятного пользовательского интерфейса для работы с картой.

Реализация функций добавления, редактирования, удаления и просмотра маркеров, линий и полигонов на карте.

Обеспечение возможности привязки к маркерам, линиям и полигонам текстовых описаний, характеристик, изображений и документов.

Реализация отображения картографических слоев, полученных с дрона (например, Quantum-systems Trinity), с возможностью просмотра актуальных и исторических снимков по дате съемки.

Интеграция с сервисом онлайн-редактирования документов (OnlyOffice).

Реализация функционала импорта геоданных из KML-файлов.

Внедрение ролевой модели доступа к функционалу и данным системы.

Разработка подсистемы аутентификации пользователей с верификацией email и одноразовыми паролями (OTP).

Обеспечение полнотекстового поиска по данным карты и содержимому документов.

Контейнеризация всех компонентов системы для упрощения развертывания и масштабирования.

Обеспечение высокой производительности, надежности и безопасности системы.

1.3. Область применения
Система предназначена для использования сотрудниками организации, которым требуется визуализация, анализ и управление геопространственными данными, связанными с инфраструктурой, активами или операциями организации (например, трансформаторные станции, линии электропередач, карьеры, объекты недвижимости и т.д.), а также для анализа актуальных и исторических аэрофотоснимков территории.

2. Описание системы
   2.1. Название системы
   Система интерактивной карты организации (или "ГеоИнфоСистема").

2.2. Функциональное назначение
Система представляет собой веб-приложение, позволяющее пользователям просматривать интерактивную карту, на которой отображаются различные объекты (маркеры, линии, полигоны), а также слои картографических данных, полученных с дронов. Каждый объект (маркер, линия, полигон) может содержать детальную информацию, характеристики и привязанные документы. Система обеспечивает управление доступом на основе ролей и предоставляет инструменты для поиска и редактирования данных.

2.3. Основные функции
2.3.1. Функции работы с картой:

Отображение интерактивной карты на базе OpenLayers.

Навигация по карте (зумирование, панорамирование).

Отображение маркеров (точек) на карте.

Отображение линий на карте.

Отображение полигонов (многоугольников) на карте.

Отображение картографических слоев (изображений) с геометаданными, полученных с дрона.

Возможность выбора и переключения между различными слоями дроновых снимков (по дате съемки).

Возможность регулировки прозрачности (opacity) слоев дроновых снимков.

При клике на маркер/линию/полигон:

Открытие всплывающего окна (инфо-окна) с основной информацией.

Отображение детальной информации (название, описание, характеристики).

Отображение списка привязанных документов и изображений.

Возможность просмотра/скачивания привязанных документов/изображений.

2.3.2. Функции управления данными (для авторизованных пользователей с соответствующими правами):

Управление маркерами:

Добавление нового маркера на карту (по клику, по координатам).

Редактирование существующего маркера (изменение названия, описания, типа, координат).

Удаление маркера.

Привязка документов и изображений к маркеру.

Удаление привязанных документов и изображений.

Управление линиями:

Добавление новой линии на карту (по точкам).

Редактирование существующей линии (изменение названия, описания, типа, точек).

Удаление линии.

Привязка документов и изображений к линии.

Удаление привязанных документов и изображений.

Управление полигонами:

Добавление нового полигона на карту (по точкам).

Редактирование существующего полигона (изменение названия, описания, типа, точек).

Удаление полигона.

Привязка документов и изображений к полигону.

Удаление привязанных документов и изображений.

Управление дроновыми снимками:

Загрузка картографических данных (GeoTIFF) с дрона в систему администратором. Загруженные файлы хранятся в собственном хранилище GeoServer.

Бэкенд сообщает GeoServer о новом файле и создает новый слой.

GeoServer отвечает за обработку GeoTIFF и предоставление слоев по протоколам WMS/WMTS.

Хранение метаданных о дроновых полетах (дата съемки, охват, разрешение) в основной базе данных.

Возможность удаления загруженных слоев дроновых снимков через бэкенд, который также удаляет слой из GeoServer.

2.3.3. Функции управления документами:

Загрузка документов (PDF, DOCX, XLSX, PPTX, TXT и др.) и изображений (JPG, PNG и др.) в систему.

Скачивание привязанных документов и изображений.

Интеграция с OnlyOffice:

Открытие поддерживаемых типов документов (DOCX, XLSX, PPTX) для онлайн-редактирования в OnlyOffice.

Автоматическое сохранение изменений из OnlyOffice обратно в систему.

2.3.4. Функции импорта данных:

Импорт KML-файлов:

Загрузка KML-файлов через пользовательский интерфейс.

Парсинг KML-файла и извлечение геометрий (точек, линий, полигонов) и их метаданных (название, описание).

Сохранение импортированных геоданных в базу данных как маркеры, линии или (при необходимости) новые типы объектов (включая полигоны).

2.3.5. Функции поиска:

Полнотекстовый поиск по названию, описанию и типу маркеров, линий, полигонов и содержимому документов.

Поиск по метаданным дроновых снимков (например, по дате съемки, названию области).

Полнотекстовый поиск по содержимому привязанных документов.

Отображение результатов поиска на карте (подсветка, центрирование).

2.3.6. Функции управления доступом и безопасностью:

Аутентификация пользователей:

Регистрация новых пользователей.

Вход в систему по логину (email) и паролю.

Верификация email при регистрации (отправка ссылки/кода подтверждения).

Восстановление пароля с использованием OTP (одноразового пароля), отправляемого на email.

Авторизация (ролевая модель доступа - RBAC):

Поддержка ролей: ADMIN, EDITOR, VIEWER (или аналогичных).

ADMIN: Полный доступ ко всем функциям, включая управление пользователями, ролями, маркерами, линиями, полигонами, документами, а также загрузку и управление дроновыми снимками.

EDITOR: Доступ к добавлению, редактированию и удалению маркеров, линий и полигонов (возможно, только своих или в определенных областях), загрузке/редактированию документов.

VIEWER: Только просмотр карты, маркеров, линий, полигонов, связанных документов, и доступных слоев дроновых снимков.

Ограничение доступа к API-конечным точкам на основе ролей.

Ограничение видимости элементов UI на фронтенде в зависимости от роли пользователя.

2.3.7. Административные функции (для роли ADMIN):

Управление пользователями (добавление, редактирование, удаление).

Назначение и изменение ролей пользователей.

Просмотр логов системы.

2.4. Основные пользователи и их роли
Администратор (ADMIN): Отвечает за настройку системы, управление пользователями, ролями и полный контроль над данными, включая управление слоями дроновых снимков.

Редактор (EDITOR): Отвечает за добавление, изменение и удаление геообъектов (включая полигоны) и привязанных к ним документов.

Просмотрщик (VIEWER): Использует систему для просмотра информации на карте и ознакомления с документами, а также для просмотра доступных слоев дроновых снимков.

3. Требования к системе
   3.1. Функциональные требования
   ФТ.1.1. Карта: Система должна отображать интерактивную карту на базе OpenLayers.

ФТ.1.2. Маркеры: Система должна отображать маркеры на карте с возможностью настройки их внешнего вида (например, по типу).

ФТ.1.3. Линии: Система должна отображать линии на карте с возможностью настройки их внешнего вида (например, по типу).

ФТ.1.4. Полигоны: Система должна отображать полигоны на карте с возможностью настройки их внешнего вида (например, по типу, цвету заливки и обводки).

ФТ.1.5. Слои дроновых снимков: Система должна отображать картографические данные (изображения с геометаданными), полученные с дрона, в виде отдельных слоев на карте.

ФТ.1.6. Выбор слоя дроновых снимков: Система должна предоставлять интерфейс для выбора и переключения между различными слоями дроновых снимков по дате съемки.

ФТ.1.7. Прозрачность слоя дроновых снимков: Система должна позволять регулировать прозрачность отображаемого слоя дроновых снимков.

ФТ.1.8. Инфо-окна: При клике на маркер/линию/полигон должно открываться всплывающее окно с детальной информацией и списком привязанных документов.

ФТ.2.1. Добавление маркера: Система должна позволять добавлять маркер на карту, указывая название, описание, тип, координаты и привязывая документы/изображения.

ФТ.2.2. Редактирование маркера: Система должна позволять редактировать существующие маркеры.

ФТ.2.3. Удаление маркера: Система должна позволять удалять маркеры.

ФТ.2.4. Добавление линии: Система должна позволять добавлять линию на карту, указывая название, описание, тип, набор координат и привязывая документы/изображения.

ФТ.2.5. Редактирование линии: Система должна позволять редактировать существующие линии.

ФТ.2.6. Удаление линии: Система должна позволять удалять линии.

ФТ.2.7. Добавление полигона: Система должна позволять добавлять полигон на карту, указывая название, описание, тип, набор координат вершин и привязывая документы/изображения.

ФТ.2.8. Редактирование полигона: Система должна позволять редактировать существующие полигоны.

ФТ.2.9. Удаление полигона: Система должна позволять удалять полигоны.

ФТ.2.10. Загрузка дроновых снимков: Система должна позволять загружать картографические данные (GeoTIFF) с дрона. Администратор загружает файл в систему, которая передает его GeoServer для публикации нового слоя.

ФТ.2.11. Управление метаданными дроновых снимков: Система должна хранить и позволять управлять метаданными о загруженных дроновых снимках (дата съемки, охват, разрешение) в основной базе данных.

ФТ.3.1. Загрузка документов: Система должна поддерживать загрузку документов и изображений различных форматов.

ФТ.3.2. Скачивание документов: Система должна обеспечивать скачивание привязанных документов.

ФТ.3.3. Онлайн-редактирование: Система должна предоставлять возможность онлайн-редактирования документов (DOCX, XLSX, PPTX) через интеграцию с OnlyOffice.

ФТ.3.4. Сохранение изменений OnlyOffice: Система должна автоматически сохранять изменения, внесенные в OnlyOffice, обратно в хранилище.

ФТ.4.1. Импорт KML: Система должна позволять импортировать KML-файлы, парсить их содержимое и сохранять геометрии (точки, линии, полигоны) и метаданные в базу данных.

ФТ.5.1. Полнотекстовый поиск: Система должна обеспечивать полнотекстовый поиск по атрибутам маркеров, линий, полигонов и содержимому документов, а также по метаданным дроновых снимков.

ФТ.6.1. Регистрация: Система должна предоставлять форму регистрации новых пользователей.

ФТ.6.2. Вход: Система должна предоставлять форму входа для зарегистрированных пользователей.

ФТ.6.3. Верификация Email: Система должна отправлять письмо для верификации email при регистрации и требовать подтверждения для активации аккаунта.

ФТ.6.4. Восстановление пароля: Система должна предоставлять механизм восстановления пароля с использованием OTP по email.

ФТ.6.5. Ролевой доступ: Система должна применять ролевую модель доступа (RBAC) к функциям и данным.

ФТ.7.1. Управление пользователями (ADMIN): Администратор должен иметь возможность добавлять, редактировать и удалять пользователей.

ФТ.7.2. Управление ролями (ADMIN): Администратор должен иметь возможность назначать и изменять роли пользователей.

3.2. Нефункциональные требования
3.2.1. Требования к производительности:

НФТ.1.1. Время отклика: Время отклика системы на пользовательские запросы (загрузка карты, отображение инфо-окна, поиск, переключение слоев дроновых снимков) не должно превышать 3 секунд при нормальной нагрузке.

НФТ.1.2. Загрузка данных: Загрузка 1000 маркеров, 100 линий, 50 полигонов и одного слоя дроновых снимков на карту должна занимать не более 5 секунд.

НФТ.1.3. Поиск: Поиск по 100 000 документам и метаданным 1000 дроновых снимков должен возвращать результаты в течение 2 секунд.

НФТ.1.4. Обработка дроновых снимков: Процесс публикации нового слоя в GeoServer для одного ортофотоплана размером до 1 ГБ должен занимать не более 10 минут.

3.2.2. Требования к надежности:

НФТ.2.1. Доступность: Система должна быть доступна 99.5% времени (исключая плановые технические работы).

НФТ.2.2. Устойчивость к ошибкам: Система должна корректно обрабатывать ошибки ввода данных, сетевые сбои и ошибки внешних сервисов, предоставляя пользователю информативные сообщения.

НФТ.2.3. Целостность данных: Система должна обеспечивать целостность и непротиворечивость хранимых данных.

3.2.3. Требования к безопасности:

НФТ.3.1. Защита данных: Все конфиденциальные данные (пароли пользователей, API-ключи) должны храниться в зашифрованном виде.

НФТ.3.2. Защита от атак: Система должна быть устойчива к распространенным веб-атакам (SQL-инъекции, XSS, CSRF и т.д.).

НФТ.3.3. Аудит: Система должна логировать действия пользователей, связанные с изменением данных и доступом к конфиденциальной информации.

НФТ.3.4. Управление доступом: Реализация RBAC должна быть строгой и исключать несанкционированный доступ к функциям и данным.

3.2.4. Требования к масштабируемости:

НФТ.4.1. Вертикальная масштабируемость: Возможность увеличения ресурсов (CPU, RAM) для отдельных компонентов системы.

НФТ.4.2. Горизонтальная масштабируемость: Возможность добавления новых экземпляров сервисов для распределения нагрузки.

НФТ.4.3. Объем данных: Система должна быть способна хранить и обрабатывать до 1 000 000 маркеров/линий/полигонов, до 10 ТБ документов и до 50 ТБ дроновых снимков.

3.2.5. Требования к удобству использования (Usability):

НФТ.5.1. Интуитивный интерфейс: Пользовательский интерфейс должен быть простым и интуитивно понятным, не требующим длительного обучения.

НФТ.5.2. Адаптивный дизайн: Интерфейс должен корректно отображаться и функционировать на различных устройствах (десктоп, планшет, мобильный телефон).

НФТ.5.3. Обратная связь: Система должна предоставлять четкую обратную связь пользователю о статусе операций.

3.2.6. Требования к совместимости:

НФТ.6.1. Браузеры: Система должна корректно работать в актуальных версиях основных веб-браузеров (Chrome, Firefox, Safari, Edge).

НФТ.6.2. Операционные системы: Система должна быть независима от операционной системы клиента.

3.2.7. Требования к развертыванию:

НФТ.7.1. Контейнеризация: Все компоненты системы должны быть упакованы в Docker-контейнеры.

НФТ.7.2. Оркестрация: Должна быть предусмотрена возможность развертывания системы с использованием Docker Compose.

3.2.8. Требования к поддержке:

НФТ.8.1. Логирование: Система должна вести подробные логи для всех компонентов.

НФТ.8.2. Мониторинг: Должна быть предусмотрена возможность интеграции с системами мониторинга.

4. Архитектура и технологии
   4.1. Общая архитектура
   Система будет построена на основе микросервисной архитектуры с использованием API Gateway на Spring Boot. Каждый микросервис будет иметь свою собственную базу данных (модель "Database per Microservice").

Ключевые принципы:

API Gateway: Единая точка входа для всех клиентских запросов. Обеспечивает централизованную аутентификацию и маршрутизацию.

Database per Microservice: Сервисы изолированы и независимы, что повышает отказоустойчивость и упрощает их масштабирование.

GeoServer: Обработка и предоставление тяжелых геопространственных данных (GeoTIFF) по стандартам WMS/WMTS.

Асинхронное взаимодействие: Использование Kafka для неблокирующих операций (например, индексация документов для поиска).

4.2. Технологический стек
API Gateway: Spring Cloud Gateway (Java)

Роль: Маршрутизация, централизованная проверка JWT-токенов.

Фронтенд: Vue.js (с Vue Router, Vuex, Vuetify/Element UI/Quasar)

Картографический сервис: OpenLayers

Сервер геоданных: GeoServer (отдельный Docker-контейнер со своим хранилищем)

Бэкенд-сервисы (Микросервисы на Spring Boot):

Сервис аутентификации (Auth Service): Управление пользователями, ролями, JWT-токенами, email-верификацией. База данных: PostgreSQL.

Сервис геоданных (Geo Data Service): Управление маркерами, линиями, полигонами, KML-парсингом. База данных: PostgreSQL с расширением PostGIS.

Сервис документов (Document Service): Управление загрузкой, хранением документов (MinIO) и интеграцией с OnlyOffice. База данных: PostgreSQL.

Сервис дроновых снимков (Drone Layer Service): Управление метаданными снимков, интеграция с GeoServer (публикация/удаление слоев). База данных: PostgreSQL.

Сервис поиска (Search Service): Индексация данных и выполнение полнотекстового поиска через Elasticsearch. База данных: Elasticsearch.

Объектное хранилище: MinIO (S3-совместимое)

Брокер сообщений: Apache Kafka

Онлайн-редактирование документов: OnlyOffice Document Server

Контейнеризация: Docker, Docker Compose

5. Этапы разработки
   Разработка системы будет осуществляться по итеративной модели и включать следующие основные этапы:

5.1. Планирование и анализ требований (Текущий этап)
Детализация ТЗ.

Оценка сроков и ресурсов.

Формирование команды.

5.2. Проектирование
Разработка детальной архитектуры системы.

Проектирование базы данных (ER-диаграммы, схемы) для каждого микросервиса.

Проектирование API (RESTful endpoints, DTOs) для API Gateway и внутренних сервисов.

Проектирование пользовательского интерфейса (UI/UX-макеты).

Выбор конкретных библиотек и фреймворков.

5.3. Разработка
Инфраструктура: Настройка Docker Compose для всех компонентов (включая GeoServer, OnlyOffice, MinIO, Kafka). Разработка API Gateway.

Сервисы: Последовательная разработка микросервисов, начиная с Auth Service и Geo Data Service.

Фронтенд: Реализация UI, интеграция с OpenLayers и API Gateway.

5.4. Тестирование
Модульное тестирование каждого микросервиса.

Интеграционное тестирование взаимодействия сервисов и API Gateway.

Функциональное тестирование.

Нагрузочное тестирование.

Тестирование безопасности.

Приемочное тестирование с участием заказчика.

5.5. Развертывание
Подготовка производственной среды.

Развертывание системы в контейнерах.

Настройка мониторинга и логирования.

5.6. Поддержка и развитие
Исправление ошибок.

Выпуск обновлений.

Реализация новых функций по запросу.

6. Требования к документации
   По итогам разработки должны быть предоставлены следующие виды документации:

Техническое задание (данный документ).

Архитектурное описание системы.

Схема базы данных.

Документация по API (например, Swagger/OpenAPI).

Руководство пользователя.

Руководство администратора.

Инструкции по развертыванию.

Исходный код с комментариями.

7. Глоссарий
   API (Application Programming Interface): Набор правил и протоколов, которые позволяют различным программным компонентам взаимодействовать друг с другом.

API Gateway: Единая точка входа для клиентских запросов в микросервисной архитектуре.

Database per Microservice: Архитектурный паттерн, где каждый микросервис управляет своей собственной базой данных.

GeoServer: Сервер с открытым исходным кодом, предназначенный для предоставления геопространственных данных по стандартным протоколам.

GeoTIFF: Стандартный формат файла изображений (TIFF), который включает геопространственные метаданные.

KML (Keyhole Markup Language): Язык разметки на основе XML для выражения географических аннотаций.

MinIO: Высокопроизводительное, S3-совместимое объектное хранилище.

OnlyOffice Document Server: Серверное приложение для онлайн-редактирования документов.

OpenLayers: Высокопроизводительная JavaScript-библиотека с открытым исходным кодом для разработки интерактивных веб-карт.

OTP (One-Time Password): Одноразовый пароль.

PostGIS: Пространственное расширение для базы данных PostgreSQL.

PostgreSQL: Объектно-реляционная СУБД с открытым исходным кодом.

RBAC (Role-Based Access Control): Модель управления доступом, основанная на ролях пользователей.

Spring Boot: Фреймворк для быстрой разработки приложений на Java.

Vue.js: Прогрессивный JavaScript-фреймворк для создания пользовательских интерфейсов.

WMS (Web Map Service): Стандартный протокол для предоставления геопространственных данных в виде растровых изображений.

WMTS (Web Map Tile Service): Стандартный протокол для предоставления геопространственных данных в виде набора тайлов.

JWT (JSON Web Token): Стандарт для безопасной передачи утверждений между сторонами.

Kafka: Распределенная потоковая платформа, используемая для построения конвейеров данных в реальном времени.

Elasticsearch: Распределенный RESTful поисковый и аналитический движок.