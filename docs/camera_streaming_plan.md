### **План внесения изменений: Интеграция просмотра камер Hikvision**

#### **1. Модификация `geodata-service` (Модель данных)**

1.  **Добавить тип для точечного объекта:**
    *   В сущности `ProjectPoint` в `geodata-service` будет введено поле `type` (например, enum или строка), которое будет определять тип точки: `CAMERA`, `POLE` и т.д.
2.  **Хранение данных камеры:**
    *   Для точек с типом `CAMERA` IP-адрес, порт, логин и пароль будут храниться в существующем поле `characteristics` (JSONB) сущности `ProjectPoint`. Это обеспечит гибкость и позволит избежать изменения схемы БД при добавлении новых типов оборудования.

#### **2. Создание нового микросервиса `streaming-service`**

1.  **Создать базовую структуру сервиса:**
    *   Будет создан новый модуль `streaming-service` на Spring Boot по аналогии с другими сервисами в проекте.
2.  **Реализовать API:**
    *   Будет разработан REST-контроллер со следующими эндпоинтами:
        *   `POST /api/streams/start/{cameraId}`: Запускает трансляцию.
        *   `POST /api/streams/stop/{cameraId}`: Останавливает трансляцию.
3.  **Реализовать логику:**
    *   Сервис будет использовать **Feign-клиент** для обращения к `geodata-service` с целью получения учетных данных камеры (IP, порт, логин, пароль) по её `cameraId`.
    *   Будет реализован **HTTP-клиент** для отправки команд управления в **MediaMTX API** (для динамического добавления и удаления RTSP-источников).

#### **3. Интеграция `MediaMTX` и нового сервиса в инфраструктуру**

1.  **Добавить MediaMTX в Docker:**
    *   В `docker-compose.yml` будет добавлен новый сервис `mediamtx`, настроенный для работы в общей сети с другими контейнерами.
2.  **Интегрировать `streaming-service`:**
    *   Новый сервис `streaming-service` будет добавлен в `docker-compose.yml`.
    *   Корневой `pom.xml` будет обновлен для включения модуля `streaming-service`.
    *   В `api-gateway` будет добавлен маршрут для проксирования запросов с `/api/streams/**` на `streaming-service`.

#### **4. Модификация `frontend` (Пользовательский интерфейс)**

1.  **Обновить карточку объекта:**
    *   В интерфейсе просмотра сведений о `ProjectPoint` будет добавлена логика: если у точки тип `CAMERA`, отображать кнопку "Начать просмотр".
2.  **Реализовать плеер:**
    *   При нажатии кнопки "Начать просмотр" фронтенд будет отправлять запрос на `streaming-service` (`POST /api/streams/start/{cameraId}`).
    *   В ответ он получит URL для WebRTC-трансляции, который будет передан компоненту WebRTC-видеоплеера для отображения видеопотока.
    *   При закрытии окна просмотра или по истечении таймаута без активного клиента, фронтенд будет отправлять запрос на `streaming-service` (`POST /api/streams/stop/{cameraId}`) для остановки трансляции и освобождения ресурсов.
